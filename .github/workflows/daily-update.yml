name: ğŸ¤– Daily README Update

on:
  schedule:
    # Run daily at 8:00 AM UTC
    - cron: '0 8 * * *'
  workflow_dispatch:  # Allow manual trigger
  push:
    branches: [ main ]
    paths:
      - 'scripts/daily_update.py'
      - '.github/workflows/daily-update.yml'

jobs:
  daily-update:
    name: ğŸš€ Daily Update Job
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0  # Fetch full history for contribution snake
    
      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
    
      - name: ğŸ“¦ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
    
      - name: ğŸ”§ Configure Git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git config --local pull.rebase false
    
      - name: ğŸ”‘ Setup GitHub Token
        run: |
          echo "GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}" >> $GITHUB_ENV
          echo "PUSH_CHANGES=true" >> $GITHUB_ENV
    
      - name: ğŸ¤– Run Daily Update
        run: |
          cd scripts
          python daily_update.py
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PUSH_CHANGES: 'true'
    
      - name: ğŸ“Š Upload Logs (if failed)
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: daily-update-logs
          path: |
            daily_update.log
            scripts/daily_update.log
          retention-days: 7
    
      - name: âœ… Success Notification
        if: success()
        run: |
          echo "ğŸ‰ Daily update completed successfully!"
          echo "ğŸ“… Date: $(date)"
          echo "ğŸ• Time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
    
      - name: âŒ Failure Notification
        if: failure()
        run: |
          echo "âŒ Daily update failed!"
          echo "ğŸ“… Date: $(date)"
          echo "ğŸ• Time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "ğŸ“‹ Check the logs for more details" 